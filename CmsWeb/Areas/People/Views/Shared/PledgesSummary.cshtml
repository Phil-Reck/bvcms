@using CmsData
@model CmsWeb.Areas.People.Models.ContributionsModel
@{
    var campusId = Model.Person.CampusId;
    var PledgesSummary = Model.GetPledgesSummary();
    var giving = ViewExtensions2.CurrentDatabase.UserPeopleId == Util2.CurrentPeopleId &&
        (MultipleGatewayUtils.GatewayId(ViewExtensions2.CurrentDatabase, PaymentProcessTypes.RecurringGiving) != null) &&
        ViewExtensions2.CurrentDatabase.Setting("OnlineGiving", true);
    var pledgeSumCollapse = Model.pledgeSumCollapse == true ? "in" : "";
    var collapseArrow = pledgeSumCollapse == "in" ? "down" : "right";
}
<div class="row">
    <h3>
        <a id="pledge-summary-collapse" data-toggle="collapse" href="#pledge-summary-section" aria-expanded="true" aria-controls="pledge-summary-section"><i class="fa fa-chevron-circle-@collapseArrow"></i></a>&nbsp;Pledge Summary
    </h3>
</div>
<br />
<div class="row collapse @pledgeSumCollapse" id="pledge-summary-section">
    <div class="row">
        <table class="table table-striped">
            <tr>
                <th>Fund</th>
                <th class="text-right">Pledged</th>
                <th class="text-right">Contributed</th>
                <th class="text-right">Balance</th>
                @if (giving)
                {
                    <th style="width: 50px;"></th>
                }
            </tr>
            @if (PledgesSummary != null)
            {
                foreach (var p in PledgesSummary)
                {
                    <tr>
                        <td>
                            @p.Fund
                        </td>
                        <td class="text-right">@p.AmountPledged.ToString("C")</td>
                        <td class="text-right">@p.AmountContributed.ToString("C")</td>
                        <td class="text-right">
                            @p.Balance.ToString("C")
                        </td>
                        @if (giving)
                        {
                            <td style="width: 50px;">
                                @if (p.Balance > 0)
                                {
                                    <a href="/Person2/OneTimeGift/@(campusId??0)?fundId=@p.FundId" target="_blank" class="btn btn-default btn-sm fulfillpledge"><i class="fa fa-check-circle-o"></i> Fulfill Pledge</a>
                                }
                            </td>
                        }
                    </tr>
                }
            }
        </table>
    </div>
</div>

<script>
    $(function () {
        $('#pledge-summary-section').on('hide.bs.collapse', function () {
            toggleIcons($('#pledge-summary-collapse i'), false);
            saveUserHistory('pledgesummary', false);
        });

        $('#pledge-summary-section').on('show.bs.collapse', function () {
            toggleIcons($('#pledge-summary-collapse i'), true);
            saveUserHistory('pledgesummary', true);
        });
    });
</script>
